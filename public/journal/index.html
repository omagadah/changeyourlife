<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent de Vie (v0) - Change Your Life</title>
  <link rel="stylesheet" href="/css/main.min.css">
  <style>
    .journal-container { position: fixed; inset: 20px; background: var(--glass-bg); backdrop-filter: blur(15px); border-radius: 20px; border: 1px solid var(--glass-border); padding: 25px; display: flex; flex-direction: column; gap: 20px; overflow: hidden; }
    .entry-list { flex: 1; overflow-y: auto; padding-right: 15px; }
    .entry-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; margin-bottom: 15px; transition: all 0.3s ease; }
    .entry-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .entry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .entry-date { font-size: 0.9rem; color: var(--text-secondary); }
    .mood-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
    .mood-emoji { font-size: 1.2rem; }
    .entry-content { margin-bottom: 10px; line-height: 1.5; }
    .ai-insight { background: rgba(0,170,255,0.1); border-left: 3px solid var(--accent-color); padding: 10px; margin-top: 10px; border-radius: 0 8px 8px 0; font-size: 0.9rem; }
    .new-entry { background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.3s ease; }
    .new-entry:hover { background: rgba(255,255,255,0.08); border-color: var(--accent-color); }
    .emotions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin: 15px 0; }
    .emotion-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px; cursor: pointer; transition: all 0.2s ease; display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .emotion-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
    .emotion-btn.selected { background: var(--accent-color); border-color: var(--accent-color); }
    .emotion-emoji { font-size: 1.5rem; }
    .emotion-label { font-size: 0.8rem; }
    #entry-editor { display: none; position: fixed; inset: 20px; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid var(--glass-border); padding: 25px; z-index: 1000; }
    .editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .close-editor { background: none; border: none; color: var(--text-primary); cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease; }
    .close-editor:hover { background: rgba(255,255,255,0.1); }
    textarea { width: 100%; min-height: 200px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; color: var(--text-primary); font-size: 1rem; line-height: 1.5; resize: none; margin-bottom: 20px; }
    textarea:focus { outline: none; border-color: var(--accent-color); }
    .action-row { display: flex; justify-content: flex-end; gap: 10px; }
    .btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-size: 0.9rem; transition: all 0.2s ease; }
    .btn-primary { background: var(--accent-color); color: #fff; }
    .btn-secondary { background: rgba(255,255,255,0.1); color: var(--text-primary); }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
  </style>
</head>
<body>
  <div id="vanta-birds-bg"></div>
    
  <header class="header">
    <button class="user-panel-trigger" title="Mon Compte" aria-label="Logo - Ouvrir le menu">
      <!-- SVG Logo -->
      <svg data-cyf-logo="1" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" style="width:40px;height:40px;display:block;border-radius:6px;">
        <g stroke-width="3">
          <circle cx="60" cy="60" r="40" fill="black" stroke="#3399ff" stroke-width="8"/>
          <line x1="100" y1="60" x2="130" y2="30" stroke="white"/>
          <line x1="100" y1="60" x2="130" y2="60" stroke="white"/>
          <line x1="100" y1="60" x2="130" y2="90" stroke="white"/>
          <circle cx="140" cy="30" r="10" fill="none" stroke="white"/>
          <circle cx="140" cy="60" r="10" fill="none" stroke="white"/>
          <circle cx="140" cy="90" r="10" fill="none" stroke="white"/>
        </g>
      </svg>
    </button>
  </header>

  <div class="journal-container" style="display:grid;grid-template-columns: minmax(320px, 520px) 1fr; gap:18px;">
    <section id="life-builder" style="overflow:auto">
      <h1>Agent de Vie</h1>
      <div class="subtle" style="margin-bottom:10px">Retranscris ta vie étape par étape (pyramide de Maslow, identité, objectifs). Tes niveaux progressent en fonction de ton avancement.</div>

      <div class="card" style="margin-bottom:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12)">
        <div class="kv"><strong>Progression</strong><span id="lm-progress-label" class="subtle">0%</span></div>
        <div class="progress"><div id="lm-progress" class="bar" style="width:0%"></div></div>
      </div>

      <form id="lm-form" class="stack" style="display:flex;flex-direction:column;gap:12px">
        <div class="card">
          <h3>1) Besoins physiologiques</h3>
          <div class="subtle">Sommeil, alimentation, santé</div>
          <label style="display:block;margin-top:8px">État (0-5)</label>
          <input type="range" min="0" max="5" step="1" id="maslow-physio-score" />
          <label style="display:block;margin-top:8px">Notes</label>
          <textarea id="maslow-physio-notes" placeholder="Renseigne tes habitudes de base..."></textarea>
        </div>
        <div class="card">
          <h3>2) Sécurité</h3>
          <div class="subtle">Stabilité, finances, logement</div>
          <label style="display:block;margin-top:8px">État (0-5)</label>
          <input type="range" min="0" max="5" step="1" id="maslow-security-score" />
          <label style="display:block;margin-top:8px">Notes</label>
          <textarea id="maslow-security-notes" placeholder="Finances, environnement, routine..."></textarea>
        </div>
        <div class="card">
          <h3>3) Amour / Appartenance</h3>
          <div class="subtle">Relations, soutien, communauté</div>
          <label style="display:block;margin-top:8px">État (0-5)</label>
          <input type="range" min="0" max="5" step="1" id="maslow-love-score" />
          <label style="display:block;margin-top:8px">Notes</label>
          <textarea id="maslow-love-notes" placeholder="Amis, famille, cercle, appartenance..."></textarea>
        </div>
        <div class="card">
          <h3>4) Estime</h3>
          <div class="subtle">Confiance, respect, accomplissements</div>
          <label style="display:block;margin-top:8px">État (0-5)</label>
          <input type="range" min="0" max="5" step="1" id="maslow-esteem-score" />
          <label style="display:block;margin-top:8px">Notes</label>
          <textarea id="maslow-esteem-notes" placeholder="Fiertés, compétences, confiance..."></textarea>
        </div>
        <div class="card">
          <h3>5) Réalisation de soi</h3>
          <div class="subtle">Sens, expression, créativité</div>
          <label style="display:block;margin-top:8px">État (0-5)</label>
          <input type="range" min="0" max="5" step="1" id="maslow-actual-score" />
          <label style="display:block;margin-top:8px">Notes</label>
          <textarea id="maslow-actual-notes" placeholder="Expression, mission, apprentissages..."></textarea>
        </div>

        <div class="card">
          <h3>Identité & Direction</h3>
          <label style="display:block;margin-top:8px">Vision personnelle</label>
          <textarea id="id-vision" placeholder="À quoi ressemble ta vie idéale ?"></textarea>
          <label style="display:block;margin-top:8px">Valeurs (séparées par des virgules)</label>
          <input id="id-values" class="input" placeholder="Ex: santé, famille, liberté"/>
          <label style="display:block;margin-top:8px">Forces</label>
          <textarea id="id-strengths" placeholder="Tes points forts"></textarea>
          <label style="display:block;margin-top:8px">Objectifs (court terme)</label>
          <textarea id="goals-short" placeholder="3-6 mois"></textarea>
          <label style="display:block;margin-top:8px">Objectifs (long terme)</label>
          <textarea id="goals-long" placeholder="1-3 ans"></textarea>
        </div>

        <div class="row" style="justify-content:flex-end">
          <button type="button" id="lm-save" class="btn btn-primary">Enregistrer & Calculer</button>
        </div>
      </form>
    </section>

    <aside id="agent-pane" style="border-left:1px solid rgba(255,255,255,0.1);padding-left:12px;overflow:hidden;display:flex;flex-direction:column;gap:10px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2 style="margin:0">Assistant IA (v0.app)</h2>
        <a href="https://v0.app/chat/ai-agent-builder-roAX5JAUfYt" target="_blank" rel="noopener" class="btn btn-secondary">Ouvrir dans un onglet</a>
      </div>
      <div style="flex:1;min-height:320px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.12)">
        <iframe src="https://v0.app/chat/ai-agent-builder-roAX5JAUfYt" title="Agent IA"
          style="width:100%;height:100%;border:0;background:rgba(0,0,0,0.05)" 
          allow="clipboard-read; clipboard-write; microphone; camera; geolocation;" 
          referrerpolicy="no-referrer" loading="lazy"></iframe>
      </div>
      <div class="subtle">Tu peux discuter avec l’agent pour clarifier ta vision et tes priorités. Reviens sur la colonne de gauche pour consigner et sauvegarder.</div>
    </aside>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.birds.min.js"></script>
  
  <script type="module" src="/js/agent-builder.js"></script>
  <script type="module">
    import { updateGlobalAvatar } from '/js/common.js';
    import { initUserMenu } from '/js/userMenu.js';
        
    // Init Vanta.js background
    window.addEventListener('DOMContentLoaded', () => {
      const vantaBg = VANTA.BIRDS({
        el: "#vanta-birds-bg",
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        backgroundColor: 0x07192f,
        color1: 0x4a3a3a,
        color2: 0xcccccc,
        quantity: 4.00
      });

      // Ensure the canvas doesn't capture pointer events
      setTimeout(() => {
        const canvas = document.querySelector('#vanta-birds-bg canvas');
        if (canvas) {
          canvas.style.pointerEvents = 'none';
          canvas.style.zIndex = '0';
          document.getElementById('vanta-birds-bg').style.zIndex = '0';
        }
      }, 100);
    });

    // Initialize UI components
    window.addEventListener('DOMContentLoaded', () => { try { updateGlobalAvatar(); } catch (e) {} });

    // Handle menu clicks
    document.querySelectorAll('.user-panel-trigger').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        initUserMenu();
        const menu = document.getElementById('cyf-user-menu');
        if (menu) {
          menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
      });
    });
  </script>
</body>
</html>
